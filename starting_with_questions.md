Answer the following questions and provide the SQL queries used to find the answer.

    
**Question 1: Which cities and countries have the highest level of transaction revenues on the site?**


SQL Queries:

--first create a temp_table from ananlytics where the unit_price and the units_sold columns are multiplied and then all the diffrent sales are added together to repersent the totalrevenue for each fullvisitorid

CREATE TEMPORARY TABLE temp_table AS
    SELECT fullvisitorid, SUM(unit_price * units_sold) AS totaltransactionrevenue
    FROM analytics
    GROUP BY fullvisitorid;

--use the temp table to join to all_sessions using fullvisitorid. Then group all fullvisitorids by country and sort by highest.

SELECT a.country, MAX(t.totaltransactionrevenue) AS max_revenue
    FROM temp_table t
    JOIN all_sessions a ON t.fullvisitorid = a.fullvisitorid
    GROUP BY a.country
    ORDER BY max_revenue DESC
    LIMIT 10

--do the same but with city this time

SELECT a.city, MAX(t.totaltransactionrevenue) AS max_revenue
    FROM temp_table t
    JOIN all_sessions a ON t.fullvisitorid = a.fullvisitorid
    GROUP BY a.city
    ORDER BY max_revenue DESC
    LIMIT 10

Answer:
The United States has the highest revenue and Mountain View is the highest earning city.

**Question 2: What is the average number of products ordered from visitors in each city and country?**


SQL Queries:

--Create an additional temp table that contains the average amount of units sold per fullvisitorid.

CREATE TEMP TABLE temp_table2 AS
    SELECT a.country, AVG(b.units_sold) AS average_products
    FROM all_sessions a
    JOIN analytics b ON a.fullvisitorid = b.fullvisitorid
    GROUP BY a.country
    ORDER BY average_products DESC;

-- Same process but by city

DROP TABLE IF EXISTS temp_table2;

CREATE TEMP TABLE temp_table2 AS
    SELECT a.city, AVG(b.units_sold) AS average_products
    FROM all_sessions a
    JOIN analytics b ON a.fullvisitorid = b.fullvisitorid
    GROUP BY a.city
    ORDER BY average_products DESC;

Answer:

The most amount of products on average ordered is by Czechia and by San Bruno

**Question 3: Is there any pattern in the types (product categories) of products ordered from visitors in each city and country?**


SQL Queries:

-- We are going to first group all of the product categories by country and then we will select only the top two product categories for each country. This will show us what the most popular product types are across each country.

SELECT v2productcategory, country, count
FROM (
  SELECT v2productcategory, country, COUNT(*) AS count,
         ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rn
  FROM all_sessions
  GROUP BY v2productcategory, country
) AS subquery
WHERE rn <= 2
ORDER BY country, count DESC;

--Next we do the same thing by city expect we add an additional filter to remove any results less than 3 in the count.

SELECT v2productcategory, city, count
FROM (
  SELECT v2productcategory, city, COUNT(*) AS count,
         ROW_NUMBER() OVER (PARTITION BY city ORDER BY COUNT(*) DESC) AS rn
  FROM all_sessions
  GROUP BY v2productcategory, city
) AS subquery
WHERE rn <= 2 and count > 3
ORDER BY city, count DESC;

Answer:

There is a distinct pattern in the product categories. The biggest product cateogory tends to be Mens Tshirts and the second biggest is the shop by Brand/ Youtube category. So the majority of the sales are specifically tied to mens t-shirt sales or by the youtube brand.

**Question 4: What is the top-selling product from each city/country? Can we find any pattern worthy of noting in the products sold?**


SQL Queries:

--We first join tables analytics and all_sessions and we find out the total amount of units sold per product for each country and then we join the the products table to get the name of the product.
SELECT p.productsku, p.name, a.country, a.total_units_sold
FROM (
  SELECT a.productsku, a.country, SUM(an.units_sold) AS total_units_sold
  FROM all_sessions a
  JOIN analytics an ON a.fullvisitorid = an.fullvisitorid
  GROUP BY a.productsku, a.country
) a
JOIN products p ON a.productsku = p.productsku
ORDER BY a.productsku, a.country;
--Then we do the same by city.
SELECT p.productsku, p.name, a.city, a.total_units_sold
FROM (
  SELECT a.productsku, a.city, SUM(an.units_sold) AS total_units_sold
  FROM all_sessions a
  JOIN analytics an ON a.fullvisitorid = an.fullvisitorid
  GROUP BY a.productsku, a.city
) a
JOIN products p ON a.productsku = p.productsku
ORDER BY a.productsku, a.city;


Answer: 

We find out that the variety of products sold goes up and it becomes more difficult to determine any patterns in ordering. The most sold item in the United States is a collpasible dog bowl and it went to an unknown city.




**Question 5: Can we summarize the impact of revenue generated from each city/country?**

SQL Queries:

-- This brings up the temp table that shows the revneue generated by country.

SELECT a.country, MAX(t.totaltransactionrevenue) AS max_revenue
    FROM temp_table t
    JOIN all_sessions a ON t.fullvisitorid = a.fullvisitorid
    GROUP BY a.country
    ORDER BY max_revenue DESC
    LIMIT 10

--AS well as the using the same table to determine the highest revenue city.

SELECT a.city, MAX(t.totaltransactionrevenue) AS max_revenue
    FROM temp_table t
    JOIN all_sessions a ON t.fullvisitorid = a.fullvisitorid
    GROUP BY a.city
    ORDER BY max_revenue DESC
    LIMIT 10

Answer:

The majority of all of the revenue is generated through Mountain View in the United States. The next highest city is unavailable. This just shows that the majority of the revenue is generated within the United States and the unavailable data from the city column just suggests that other American city also provide large amount of revenue. Therefore the data analysis can either suggest that the company should either focus on increasing its local sales as that is the majority of its sales, or that there is oppurtunity for international expansion, depending on the companies ability to keep export costs low.






